{% extends 'base.html' %}

{% block content %}

<div class="feed-page">
    <!-- Fixed title at top -->
    <h1 class="feed-title">Public Feed</h1>

    <!-- Scrollable feed container -->
    <div class="feed-wrapper">
        <main class="shorts-feed">
            {% for post in posts %}
            <article class="short-card">
                <div class="short-header">
                    <span class="username">@{{ post.created_by.username }}</span>
                    <span class="timestamp">{{ post.created_at|timesince }} ago</span>
                </div>

                <a href="{% url 'feed_content' post.id %}" class="short-link">
                    <h2 class="short-title">{{ post.title }}</h2>
                </a>

                <div class="short-preview">
                    {{ post.content|truncatewords:65|linebreaksbr }}
                </div>

                <div class="short-meta">
                    <span class="topic-tag">{{ post.topic.name|default:"General" }}</span>
                    
                    {% if post.created_by == user %}
                    <div class="short-actions">
                        <a href="{% url 'update_post' post.id %}" class="action-edit">Edit</a>
                        <a href="{% url 'delete_post' post.id %}" class="action-delete"
                           onclick="return confirm('Delete forever? ðŸ”¥');">Delete</a>
                    </div>
                    {% endif %}
                </div>
            </article>
            {% empty %}
            <div class="empty-state">
                <p>No confessions yet...</p>
                <p>Be the first to get <strong>cooked</strong>! ðŸ˜ˆ</p>
                {% if user.is_authenticated %}
                <a href="{% url 'create_post' %}" class="btn btn-start">Confess Now</a>
                {% endif %}
            </div>
            {% endfor %}
        </main>
    </div>
</div>

<style>
    /* Fixed height container - prevents page scroll */
    .feed-page {
        height: 100vh;
        max-height: 100vh;
        overflow: hidden;
        background: var(--bg);
        display: flex;
        flex-direction: column;
        position: relative;
    }

    /* Fixed title at top */
    .feed-title {
        font-family: 'Orbitron', monospace;
        text-align: center;
        color: var(--red);
        font-size: clamp(1.6rem, 5vw, 2.2rem);
        margin: 0;
        padding: clamp(1rem, 3vw, 1.5rem) 5%;
        font-weight: 700;
        letter-spacing: -0.5px;
        opacity: 0.9;
        flex-shrink: 0;
        background: var(--bg);
        position: sticky;
        top: 0;
        z-index: 10;
        border-bottom: 1px solid rgba(255,45,85,0.1);
    }

    /* Scrollable wrapper */
    .feed-wrapper {
        flex: 1;
        overflow: hidden;
        position: relative;
    }

    /* Main scrollable feed - ONLY this scrolls */
    .shorts-feed {
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        display: flex;
        flex-direction: column;
        gap: clamp(0.8rem, 2vw, 1.2rem);
        padding: clamp(1rem, 3vw, 1.5rem) 5%;
        padding-bottom: clamp(2rem, 5vw, 3rem);
        
        /* Custom scrollbar */
        scrollbar-width: thin;
        scrollbar-color: var(--red) rgba(30,30,40,0.7);
    }

    .shorts-feed::-webkit-scrollbar {
        width: 8px;
    }

    .shorts-feed::-webkit-scrollbar-track {
        background: rgba(30,30,40,0.7);
        border-radius: 4px;
    }

    .shorts-feed::-webkit-scrollbar-thumb {
        background: var(--red);
        border-radius: 4px;
        transition: background 0.3s;
    }

    .shorts-feed::-webkit-scrollbar-thumb:hover {
        background: #ff4567;
    }

    .short-card {
        background: var(--bg-card);
        border: 1px solid rgba(255,45,85,0.15);
        border-radius: 14px;
        padding: clamp(1.2rem, 3.5vw, 1.8rem);
        transition: all 0.25s ease;
        flex-shrink: 0;
    }

    .short-card:hover {
        transform: translateY(-3px);
        border-color: var(--red);
        box-shadow: 0 8px 25px rgba(255,45,85,0.2);
    }

    .short-header {
        display: flex;
        flex-wrap: wrap;
        gap: 0.8rem;
        margin-bottom: 0.8rem;
        font-size: clamp(0.85rem, 3vw, 0.95rem);
        color: var(--text-muted);
    }

    .username {
        font-weight: 700;
        color: var(--text);
    }

    .short-title {
        color: var(--red);
        font-size: clamp(1.35rem, 4.5vw, 1.9rem);
        line-height: 1.25;
        margin: 0 0 0.7rem;
        font-weight: 700;
    }

    .short-link {
        text-decoration: none;
        color: inherit;
        display: block;
    }

    .short-preview {
        color: var(--text);
        line-height: 1.55;
        font-size: clamp(0.95rem, 3.5vw, 1.1rem);
        margin-bottom: 1rem;
    }

    .short-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.8rem;
        font-size: 0.9rem;
    }

    .topic-tag {
        background: rgba(255,45,85,0.18);
        color: var(--red);
        padding: 0.25rem 0.8rem;
        border-radius: 20px;
        font-weight: 500;
        font-size: clamp(0.8rem, 2.5vw, 0.9rem);
    }

    .short-actions {
        display: flex;
        gap: 0.9rem;
    }

    .action-edit, .action-delete {
        color: var(--text-muted);
        text-decoration: none;
        font-size: 0.9rem;
        padding: 0.4rem 0.9rem;
        border-radius: 6px;
        transition: all 0.2s;
        font-weight: 500;
    }

    .action-edit:hover {
        color: #00ff9d;
        background: rgba(0,255,157,0.1);
    }

    .action-delete:hover {
        color: var(--red);
        background: rgba(255,45,85,0.15);
    }

    .empty-state {
        text-align: center;
        padding: clamp(4rem, 10vh, 6rem) 2rem;
        color: var(--text-muted);
    }

    .empty-state p {
        font-size: clamp(1.1rem, 4vw, 1.5rem);
        margin: 1rem 0;
        line-height: 1.4;
    }

    .empty-state strong {
        color: var(--red);
    }

    .btn-start {
        display: inline-block;
        background: var(--red);
        color: white;
        padding: clamp(0.9rem, 2.5vw, 1.1rem) clamp(1.8rem, 4vw, 2.5rem);
        border-radius: 50px;
        text-decoration: none;
        font-weight: 700;
        font-size: clamp(1rem, 3vw, 1.15rem);
        margin-top: 1.5rem;
        min-height: 48px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255,45,85,0.3);
    }

    .btn-start:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 30px rgba(255,45,85,0.5);
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
        .feed-page {
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height for mobile browsers */
        }

        .feed-title {
            font-size: clamp(1.4rem, 6vw, 2rem);
            padding: 1rem 4%;
        }

        .shorts-feed {
            padding: 1rem 4%;
            padding-bottom: 2rem;
            gap: 1rem;
        }

        .short-card {
            padding: 1.3rem 1.4rem;
        }

        .short-title {
            font-size: clamp(1.3rem, 5vw, 1.8rem);
        }

        .short-preview {
            font-size: clamp(0.95rem, 3.5vw, 1.05rem);
            line-height: 1.6;
        }

        .short-header {
            gap: 0.5rem;
        }

        .short-meta {
            flex-direction: column;
            align-items: flex-start;
        }

        .short-actions {
            width: 100%;
            justify-content: flex-start;
        }

        /* Hide scrollbar on mobile for cleaner look */
        .shorts-feed {
            scrollbar-width: none;
        }

        .shorts-feed::-webkit-scrollbar {
            display: none;
        }
    }

    /* Small phones */
    @media (max-width: 480px) {
        .feed-title {
            font-size: 1.3rem;
            padding: 0.9rem 4%;
        }

        .short-card {
            padding: 1.2rem 1.2rem;
        }

        .short-preview {
            font-size: 0.95rem;
        }

        .action-edit, .action-delete {
            font-size: 0.85rem;
            padding: 0.35rem 0.75rem;
        }
    }

    /* Landscape mode on mobile */
    @media (max-width: 900px) and (max-height: 500px) {
        .feed-title {
            padding: 0.7rem 4%;
            font-size: 1.2rem;
        }

        .shorts-feed {
            padding: 0.8rem 4%;
        }

        .short-card {
            padding: 1rem;
        }
    }

    /* Prevent body scroll */
    body {
        overflow: hidden;
    }
</style>

{% endblock %}




{% comment %} {% extends 'base.html'   %}

{% block content %}
    <h1>ðŸ”¥ Public Feed</h1>


<style>
    .home-container {
        display: grid;
        grid-template-columns: 1fr 3fr;
    }
</style>
<div class="home-container">


    </div>
    <div>
        <div >
            {% for post in posts %}
            <div style="border:1px solid #ccc; margin:10px; padding:10px;">
                <span>@{{ post.created_by.username }}</span>
                <a href="/feed/{{ post.id }}/"><h3>{{ post.title }}</h3></a>
                <span>Topic: {{ post.topic }}</span>
                {% if post.created_by == user %}
                <a href="{% url 'update_post' post.id %}">Update Post</a>
                <a href="{% url 'delete_post' post.id %}">Delete Post</a>
                {% endif %}
                <br>
            </div>
            {% endfor %}
        </div>
    </div>
</div>


{% if not posts %}
    <p>No posts available.</p>

{% endif %}
{% endblock %} {% endcomment %}